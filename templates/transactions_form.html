{% extends "base.html" %}
{% block title %}{{ 'Editar transacción' if modo=='edit' else 'Nueva transacción' }}{% endblock %}
{% block content %}
<h1>{{ 'Editar transacción' if modo=='edit' else 'Nueva transacción' }}</h1>

<form class="card form" method="post">
  <div class="row">
    <div>
      <label>Fecha</label>
      <input type="date" name="fecha" value="{{ (item.fecha.strftime('%Y-%m-%d') if item else '') }}">
    </div>
    <div class="grow">
      <label>Concepto</label>
      <input type="text" name="concepto" value="{{ item.concepto if item else '' }}" required>
    </div>
    <div>
      <label>Importe (€)</label>
      <input type="number" step="0.01" name="importe" value="{{ '%.2f'|format(item.importe) if item else '' }}" required>
    </div>
  </div>

  <div class="row">
    <div>
      <label>Cuenta</label>
      <select name="account_id" required>
        {% for a in accounts %}
          <option value="{{a.id}}" {% if item and item.account_id==a.id %}selected{% endif %}>{{a.nombre}}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Categoría</label>
      <select name="category_id" required>
        <optgroup label="Ingresos">
          {% for c in categories if c.tipo=='ingreso' %}
            <option value="{{c.id}}" {% if item and item.category_id==c.id %}selected{% endif %}>{{c.nombre}}</option>
          {% endfor %}
        </optgroup>
        <optgroup label="Gastos">
          {% for c in categories if c.tipo=='gasto' %}
            <option value="{{c.id}}" {% if item and item.category_id==c.id %}selected{% endif %}>{{c.nombre}}</option>
          {% endfor %}
        </optgroup>
      </select>
    </div>
  </div>

  <div>
    <label>Nota (opcional)</label>
    <textarea name="nota" rows="3">{{ item.nota if item else '' }}</textarea>
  </div>

  <div class="row-end">
    <a class="btn ghost" href="{{ url_for('transactions_index') }}">Cancelar</a>
    <button class="btn primary" type="submit">{{ 'Guardar cambios' if modo=='edit' else 'Guardar' }}</button>
  </div>
</form>
{% endblock %}
